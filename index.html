<!DOCTYPE html>
<html lang='en'>
<head>
<meta charset="utf-8">
<title>Font Vectors | Force layout with images</title>
</head>


<script src="https://d3js.org/d3.v4.min.js" charset="utf-8"></script>
<!-- <script src="d3-3d.js"></script>

 -->
 <body>
    <section id='vis'></section>
<!-- <svg width="960" height="500"></svg>
<svg class="points"></svg> -->
<script>
    var tcBlack = "#130C0E";
    var  w = 960,
         h = 800, 
         maxNodeSize= 50,
         x_browser = 20, 
         y_broswer=25,
         root;
    var vis;
    var force = d3.layout.force();

    vis = d3.select("#vis").append("svg").attr("width",w).attr("height", h);

    d3.json("fonts.json", function(json){
        root = json;
        root.fixed = true;
        root.x = w/2;
        root.y = h/4;

        var defs = vis.insert("svg:defs").data(["end"]);  //????

        defs.enter().append("svg:path").attr("d", "M0,-5L10,0L0,5");
        update();
    });
    function update(){
        var nodes = flatten(root),
        links = d3.layout.tree().links(nodes);

        force.nodes(nodes)
             .links(links)
             .gravity(0.05)
             .charge(-1500)
             .linkDistance(100)
             .friction(0.5)
             .linkStrength(function(l,i){return 1;})
             .size([w,h])
             .on("tick", tick)
             .start();

        var path = vis.selectAll("path.link")
                    .data(links, function(d){return d.target.id; });

        path.enter().insert("svg:path")
        .attr("class", "link")
        .style("stroke", "#eee");

        path.exit().remove();

        var node = vis.selectAll("g.node")
        .data(nodes, function(d) {return d.id; });

        var nodeEnter = node.enter().append("svg:g")
                            .attr("class", "node")
                            .attr("transform", function(d) {return "translate(" + d.x + "," + d.y + ")";})
                            .on("click", click)
                            .call(force.drag);
        //append a circle                    
        nodeEnter.append("svg:circle")
                .attr("r", function(d) { return Math.sqrt(d.size)/10 || 4.5 ;})
                .style("fill", "#eee");
        //append images
        var images = nodeEnter.append("svg:image")
                            .attr('xlink:href', function(d){return d.img;})
                            .attr("x", function(d) {return -25;})
                            .attr("y", function(d) {return -25;})
                            .attr("height", 50)
                            .attr("width", 50);

        var setEvents = images
                    .on('mouseenter', function(){
                        d3.select(this)
                            .transition()
                            .attr('x', function(d) {return -60;})
                            .attr('y', function(d) {return -60 ;})
                            .attr('height', 100)
                            .attr('width', 100)
                    })
                    .on('mouseleave', function(){
                        d3.select(this)
                        .transition()
                        .attr('x', function(d) {return -25;})
                        .attr('y', function(d) {return -25;})
                        .attr('height', 50)
                        .attr('width', 50);
                    });
        nodeEnter.append("text")
        .attr("class", "nodetext")
        .attr('x', x_browser)
        .attr('y', y_broswer + 15)
        .attr('fill', tcBlack)
        .text(function(d) {return d.name; });

        node.exit().remove();

        path = vis.selectAll('path.link');
        node = vis.selectAll('g.node')
    function tick() {
     
     
        path.attr("d", function(d) {
     
         var dx = d.target.x - d.source.x,
               dy = d.target.y - d.source.y,
               dr = Math.sqrt(dx * dx + dy * dy);
               return   "M" + d.source.x + "," 
                + d.source.y 
                + "A" + dr + "," 
                + dr + " 0 0,1 " 
                + d.target.x + "," 
                + d.target.y;
      });
        node.attr("transform", nodeTransform);    
      }
    }

     
    /**
     * Gives the coordinates of the border for keeping the nodes inside a frame
     * http://bl.ocks.org/mbostock/1129492
     */ 
    function nodeTransform(d) {
      d.x =  Math.max(maxNodeSize, Math.min(w - (d.imgwidth/2 || 16), d.x));
        d.y =  Math.max(maxNodeSize, Math.min(h - (d.imgheight/2 || 16), d.y));
        return "translate(" + d.x + "," + d.y + ")";
       }
     
    /**
     * Toggle children on click.
     */ 
    function click(d) {
      if (d.children) {
        d._children = d.children;
        d.children = null;
      } else {
        d.children = d._children;
        d._children = null;
      }
     
      update();
    }
     
     
    /**
     * Returns a list of all nodes under the root.
     */ 
    function flatten(root) {
      var nodes = []; 
      var i = 0;
     
      function recurse(node) {
        if (node.children) 
          node.children.forEach(recurse);
        if (!node.id) 
          node.id = ++i;
        nodes.push(node);
      }
     
      recurse(root);
      return nodes;
    } 
  
  
</script>

</body>
</html>


